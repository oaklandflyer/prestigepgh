<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Pittsburgh Prestige Remodeling – Craftsmanship in Black & Gold</title>
  <meta name="description" content="Pittsburgh Prestige Remodeling — kitchens, bathrooms, basements, decks, and full-home renovations across Allegheny County. Licensed & insured general contractor delivering Pittsburgh-proud quality." />
  <meta name="keywords" content="custom cabinetry Pittsburgh, carpentry Pittsburgh, kitchen cabinets Pittsburgh, built-ins Pittsburgh, finish carpentry Pittsburgh, crown molding Pittsburgh, woodwork Pittsburgh, Pittsburgh remodeler, Pittsburgh contractor">
  <meta name="theme-color" content="#0b0f17" />
  <link rel="canonical" href="https://prestigepgh.com/" />
  <link rel="icon" href="assets/ppr_icon.png" type="image/png">
  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Pittsburgh Prestige Remodeling – Craftsmanship in Black & Gold">
  <meta property="og:description" content="Kitchens, baths, basements & full-home renovations. Pittsburgh-proud quality.">
  <meta property="og:url" content="https://prestigepgh.com/">
  <meta property="og:image" content="https://prestigepgh.com/assets/og-preview.jpg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Pittsburgh Prestige Remodeling">
  <meta name="twitter:description" content="Quality remodeling across the Pittsburgh area.">
  <meta name="twitter:image" content="https://prestigepgh.com/assets/og-preview.jpg">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

  <!-- Fancybox (for lightbox) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" />

  <!-- JSON-LD: Local Business -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "HomeAndConstructionBusiness",
    "name": "Pittsburgh Prestige Remodeling",
    "url": "https://prestigepgh.com/",
    "image": "https://prestigepgh.com/assets/ppr_logo.png",
    "logo": "https://prestigepgh.com/assets/ppr_logo.png",
    "areaServed": "Pittsburgh, Allegheny County, Pennsylvania",
    "telephone": "+1-(412)-315-9189",
    "email": "info@prestigepgh.com",
    "priceRange": "$$",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "Pittsburgh",
      "addressRegion": "PA",
      "addressCountry": "US"
    },
    "sameAs": [
      "https://www.instagram.com/",
      "https://www.linkedin.com/"
    ],
    "openingHoursSpecification": [{
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": ["Monday","Tuesday","Wednesday","Thursday","Friday"],
      "opens": "08:00",
      "closes": "18:00"
    }],
    "servesCuisine": "",
    "description": "Licensed & insured general contractor specializing in kitchen, bathroom, basement, and full-home remodeling in Pittsburgh."
  }
  </script>

  <style>
    /* ================== THEME (Dark-first, with toggle) ================== */
    :root {
      --primary:#101820;   /* deep black */
      --accent:#FFB612;    /* Steelers gold */
      --ink:#d6deff;       /* light text on dark */
      --muted:#9fb0d0;
      --bg:#0b0f17;        /* page background */
      --panel:#111926;     /* cards */
      --panel-2:#0d1522;
      --line:#1b2533;
      --radius:18px;
      --shadow:0 10px 40px rgba(0,0,0,.30);
      --cta:#FFB612;
      --cta-ink:#0b0f17;
    }
    [data-theme="light"]{
      --ink:#0e1420;
      --muted:#47556e;
      --bg:#fafafa;
      --panel:#ffffff;
      --panel-2:#f4f7fb;
      --line:#e6ebf2;
      --cta:#101820;
      --cta-ink:#ffffff;
    }

    *,*::before,*::after{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:'Montserrat',Arial,sans-serif;background:var(--bg);color:var(--ink);scroll-behavior:smooth}
    img{max-width:100%;display:block}
    a{text-decoration:none;color:inherit}

    /* ================== HEADER ================== */
    .site-header{
      position:fixed;inset-inline:0;top:0;z-index:1000;display:flex;align-items:center;justify-content:space-between;
      padding:14px clamp(16px,4vw,64px);background:rgba(11,15,23,.85);backdrop-filter:saturate(140%) blur(10px);
      box-shadow:0 1px 12px rgba(0,0,0,.35);transition:transform .32s ease, top .32s ease, background .2s;
      border-bottom:1px solid var(--line)
    }
    .brand{display:flex;align-items:center;gap:12px;font-weight:900;letter-spacing:.04em}
    .brand img{height:40px;width:auto;object-fit:contain;filter:drop-shadow(0 2px 8px rgba(0,0,0,.35))}
    .brand span{font-size:1.02rem;text-transform:uppercase}

    .site-nav ul{list-style:none;display:flex;gap:clamp(10px,2vw,28px);margin:0;padding:0}
    .site-nav a{font-weight:800;padding:10px 14px;border-radius:999px;color:var(--ink);transition:background .2s,color .2s, border-color .2s;border:1px solid transparent}
    .site-nav a:hover,.site-nav a.active,[aria-current="page"]{background:var(--accent);color:var(--cta-ink);border-color:transparent}
    .menu-toggle{display:none;width:44px;height:44px;border:none;background:none;cursor:pointer}
    .menu-toggle .bar{display:block;width:26px;height:3px;margin:5px auto;background:var(--ink);border-radius:2px;transition:.3s}
    .menu-toggle.open .bar:nth-child(1){transform:translateY(8px) rotate(45deg)}
    .menu-toggle.open .bar:nth-child(2){opacity:0}
    .menu-toggle.open .bar:nth-child(3){transform:translateY(-8px) rotate(-45deg)}
    .theme-toggle{margin-left:12px;border:1px solid var(--line);background:var(--panel);color:var(--ink);padding:8px 12px;border-radius:999px;font-weight:800;cursor:pointer}
    @media (max-width:960px){
      .menu-toggle{display:block}
      .site-nav{position:fixed;right:0;top:74px;width:min(72vw,380px);height:calc(100dvh - 74px);background:var(--panel);transform:translateX(100%);
        transition:transform .24s cubic-bezier(.4,2.2,.3,1);box-shadow:-2px 0 18px rgba(0,0,0,.38);border-left:1px solid var(--line)}
      .site-nav.open{transform:translateX(0)}
      .site-nav ul{flex-direction:column;padding:26px;gap:12px}
      body.no-scroll{overflow:hidden}
    }

    /* ================== HERO ================== */
    .hero{
      position:relative;min-height:76vh;display:flex;align-items:center;justify-content:center;border-radius:0 0 var(--radius) var(--radius);
      box-shadow:var(--shadow);overflow:hidden;margin-top:92px;
      background:
        radial-gradient(60% 60% at 110% -10%, rgba(255,182,18,.12) 0, rgba(255,182,18,0) 60%),
        radial-gradient(60% 60% at -10% 110%, rgba(255,182,18,.08) 0, rgba(255,182,18,0) 60%),
        linear-gradient(120deg, #0b0f17 0%, #0d1522 50%, #101820 100%);
      isolation:isolate
    }
    .hero::after{content:"";position:absolute;inset:0;pointer-events:none;background-image:radial-gradient(rgba(255,182,18,.08) 1px, transparent 1px);background-size:3px 3px;opacity:.35}

    .glass-wrap{position:relative;z-index:1;width:min(880px,94vw);padding:0;filter:drop-shadow(0 20px 70px rgba(0,0,0,.45))}
    .liquid-glass{
      position:relative;padding:30px 30px 26px;border-radius:28px;overflow:hidden;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.14);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.12), 0 20px 60px rgba(0,0,0,.55);
      color:#ffffff;text-align:center;backdrop-filter: blur(22px) saturate(140%)
    }
    .liquid-glass::before,.liquid-glass::after{
      content:"";position:absolute;inset:-40%;z-index:-1;
      background:
        radial-gradient(40% 40% at 20% 20%, rgba(255,182,18,.35) 0%, rgba(255,182,18,0) 60%),
        radial-gradient(35% 45% at 80% 30%, rgba(10,15,25,.45) 0%, rgba(10,15,25,0) 60%),
        radial-gradient(45% 35% at 50% 80%, rgba(255,255,255,.18) 0%, rgba(255,255,255,0) 60%);
      filter:blur(30px);animation:floatBlob 16s ease-in-out infinite alternate;opacity:.9
    }
    .liquid-glass::after{animation-duration:22s;animation-delay:-4s;transform:scale(1.05);mix-blend-mode:screen;opacity:.7}
    @keyframes floatBlob{0%{transform:translate3d(-4%,-2%,0) rotate(0) scale(1)}100%{transform:translate3d(4%,3%,0) rotate(6deg) scale(1.06)}}

    .hero h1{font-family:'Playfair Display',serif;font-size:clamp(2rem,4.6vw,3.2rem);font-weight:700;margin:0 0 12px;color:#fff;letter-spacing:.02em;text-shadow:0 2px 12px rgba(0,0,0,.55)}
    .hero p{font-size:1.1rem;margin:0 0 18px;color:#dfe8ff}
    .hero-btns{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:18px}
    .btn{background:var(--cta);color:var(--cta-ink);font-weight:900;padding:11px 28px;border-radius:999px;border:2px solid transparent;cursor:pointer;box-shadow:0 6px 22px rgba(0,0,0,.40);
      font-size:1rem;transition:transform .12s ease, background .2s,color .2s, border-color .2s;letter-spacing:.03em}
    .btn:hover,.btn:focus{background:#ffd059;color:#111;border-color:transparent;transform:translateY(-1px)}

    /* ================== SECTION WRAPPERS ================== */
    .page-hero{padding:42px clamp(24px,6vw,64px) 10px}
    .page-hero h2{font-family:'Playfair Display',serif;font-weight:700;color:#fff;font-size:clamp(1.8rem,4vw,2.4rem);margin:0 0 6px}
    .page-hero p{margin:0 0 24px;color:var(--muted)}

    /* ================== CARDS / STRIPS ================== */
    .services{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin:10px clamp(24px,6vw,64px) 50px}
    @media (max-width:900px){.services{grid-template-columns:1fr}}
    .service-card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:18px 18px 16px;box-shadow:0 8px 22px rgba(0,0,0,.25)}
    .service-card h3{margin:6px 0 6px;font-size:1.15rem;color:#fff}
    .service-card p{margin:0;color:var(--muted)}

    /* ================== GRID PLACEHOLDERS (projects) ================== */
    .controls{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin:0 clamp(24px,6vw,64px) 14px}
    .breadcrumbs{display:flex;flex-wrap:wrap;gap:8px;align-items:center;font-weight:800;color:var(--muted)}
    .breadcrumbs a{color:#fff;text-decoration:underline;text-decoration-color:rgba(255,182,18,.6)}
    .crumb-sep{opacity:.5}
    .back-btn{display:none;margin:0 clamp(24px,6vw,64px) 26px;align-items:center;gap:8px;background:var(--panel);border:1px solid var(--line);border-radius:999px;padding:9px 14px;
      font-weight:800;color:#fff;box-shadow:0 1px 10px rgba(0,0,0,.35)}
    .back-btn:hover{background:var(--accent);color:#111;border-color:transparent}

    .album-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:48px 38px;margin:0 clamp(24px,6vw,64px) 60px}
    @media (max-width:1100px){.album-grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:640px){.album-grid{grid-template-columns:1fr;gap:28px}}
    .album-card{display:flex;flex-direction:column;gap:14px}
    .album-cover{position:relative;border-radius:10px;overflow:hidden;aspect-ratio:3/2;background:linear-gradient(135deg, #0d1522, #101820);box-shadow:0 6px 26px rgba(0,0,0,.35);transition:transform .28s ease, box-shadow .28s ease, outline .2s}
    .album-card:hover .album-cover{transform:translateY(-2px);box-shadow:0 14px 36px rgba(0,0,0,.55);outline:2px solid rgba(255,182,18,.45)}

    .album-caption{display:flex;flex-direction:column;align-items:center;text-align:center}
    .album-title{font-weight:900;letter-spacing:.08em;text-transform:uppercase;color:#fff}
    .album-sub{margin-top:6px;font-size:.88rem;letter-spacing:.12em;text-transform:uppercase;color:var(--muted)}

    .photo-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin:10px clamp(24px,6vw,64px) 60px}
    @media (max-width:1100px){.photo-grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:640px){.photo-grid{grid-template-columns:1fr;gap:12px}}
    .photo{position:relative;border-radius:10px;overflow:hidden;aspect-ratio:3/2;background:linear-gradient(135deg, #0d1522, #101820);box-shadow:0 4px 18px rgba(0,0,0,.35)}

    .empty{margin:24px clamp(24px,6vw,64px);opacity:.9;text-align:center;color:var(--muted)}

    /* ================== CTA / FOOTER ================== */
    .site-footer{background:#0b0f17;color:#f0f4ff;padding:48px 6vw 36px;border-top:1px solid var(--line);margin-top:80px;text-align:center}
    .footer-cta{display:flex;gap:16px;justify-content:center;margin-bottom:18px}
    .social-links{display:flex;gap:16px;justify-content:center;margin-top:16px}
    .social-links a{font-weight:800;border-bottom:2px solid var(--accent)}

    /* ================== ACCESSIBILITY / ANIMATIONS ================== */
    @media (max-width:750px){
      .site-header{flex-direction:row}
      .hero{min-height:64vh}
      .glass-wrap{width:96vw}
      .footer-cta{flex-direction:column;gap:7px}
      .site-footer{padding:36px 2vw 24px}
    }
    @keyframes fadeInUp{from{opacity:0;transform:translateY(28px)}to{opacity:1;transform:translateY(0)}}
    @media (prefers-reduced-motion:reduce){*{animation:none!important;transition:none!important;scroll-behavior:auto!important}}
    .fade-section{opacity:0;transform:translateY(40px);transition:all .7s cubic-bezier(.25,.8,.25,1)}
    .fade-section.visible{opacity:1;transform:translateY(0)}

    .skip-link{position:absolute;left:-999px;top:auto;width:1px;height:1px;overflow:hidden;z-index:101;background:#fff;color:#103047;border-radius:0 0 10px 10px;padding:8px 22px}
    .skip-link:focus{left:12px;top:6px;width:auto;height:auto}

    /* Optional watermark deterrent (text only, no images) */
    .album-cover::before,.photo::before{
      content:"PITTSBURGH PRESTIGE REMODELING";position:absolute;right:10px;bottom:8px;padding:4px 8px;font:800 12px/1.2 Montserrat, Arial, sans-serif;color:rgba(255,255,255,.96);
      background:rgba(0,0,0,.35);border-radius:6px;letter-spacing:.06em;pointer-events:none
    }
    .album-cover::after,.photo::after{content:"";position:absolute;inset:0;background-image:repeating-linear-gradient(45deg, rgba(255,255,255,.02) 0, rgba(255,255,255,.02) 24px, rgba(0,0,0,.05) 24px, rgba(0,0,0,.05) 48px);mix-blend-mode:multiply;pointer-events:none}
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Skip to main content</a>

  <header class="site-header" id="header">
    <a href="#top" class="brand" aria-label="Pittsburgh Prestige Remodeling home">
      <!-- Logo: uses web path first; falls back to your Downloads path if missing -->
      <img id="brandLogo" src="assets/ppr_logo.png" alt="Pittsburgh Prestige Remodeling logo" />
      <span>Pittsburgh Prestige Remodeling</span>
    </a>

    <nav id="navbar" class="site-nav" aria-label="Main Navigation">
      <ul>
        <li><a href="#top" class="active" aria-current="page">Home</a></li>
        <li><a href="#services">Services</a></li>
        <li><a href="#projects">Projects</a></li>
        <li><a href="#about">About</a></li>
        <li><a href="#contact">Contact</a></li>
      </ul>
    </nav>

    <div style="display:flex;align-items:center;">
      <button id="themeToggle" class="theme-toggle" aria-pressed="true" aria-label="Toggle dark mode">Dark</button>
      <button id="menuToggle" class="menu-toggle" aria-label="Toggle navigation" aria-controls="navbar" aria-expanded="false">
        <span class="bar"></span><span class="bar"></span><span class="bar"></span>
      </button>
    </div>
  </header>

  <main id="main">
    <!-- ===== HERO ===== -->
    <section class="hero fade-section" id="top">
      <div class="glass-wrap">
        <div class="liquid-glass">
          <h1>Quality Remodeling, Pittsburgh Proud</h1>
          <p>Black & Gold craftsmanship for kitchens, bathrooms, basements, decks, and full-home renovations across the region.</p>
          <div class="hero-btns">
            <a href="#services" class="btn">View Services</a>
            <a href="#contact" class="btn">Request a Quote</a>
          </div>
        </div>
      </div>
    </section>

<!-- ===== SERVICES ===== -->
<section id="services" class="page-hero fade-section">
  <h2>Services</h2>
  <p>We specialize in custom cabinetry and fine carpentry that elevates every space — kitchens, living rooms, home offices, and more.</p>
</section>
<div class="services">
  <div class="service-card">
    <h3>Custom Cabinetry</h3>
    <p>Handcrafted cabinets, shelving, and built-ins tailored to your space. From kitchen storage to entertainment centers, we design and install with precision.</p>
  </div>
  <div class="service-card">
    <h3>Finish Carpentry</h3>
    <p>Detailed trim, crown molding, staircases, railings, and woodwork accents that bring character and lasting craftsmanship to your home.</p>
  </div>
  <div class="service-card">
    <h3>Kitchen & Living Spaces</h3>
    <p>Thoughtful layouts, wood finishes, and functional carpentry that combine style with everyday utility in the heart of your home.</p>
  </div>
</div>


    <!-- ===== PROJECTS ===== -->
    <section id="projects" class="page-hero fade-section">
      <h2>Projects</h2>
      <p>When you add photos, they’ll appear here grouped by city and project using the manifest file. Optimized for fast loading and lightbox viewing.</p>
    </section>

    <div class="controls">
      <nav class="breadcrumbs" aria-label="Breadcrumbs" id="breadcrumbs"></nav>
    </div>
    <button class="back-btn" id="backBtn">◀ Back</button>

    <section id="albumsView" class="album-grid" aria-label="Albums"></section>
    <section id="photosView" class="photo-grid" aria-label="Photos" style="display:none;"></section>
    <p id="emptyState" class="empty" hidden>No projects added yet.</p>

<!-- ===== ABOUT ===== -->
<section id="about" class="page-hero fade-section">
  <h2>About</h2>
  <p>Pittsburgh Prestige Remodeling is a licensed & insured contractor with a focus on cabinetry and carpentry. We believe true craftsmanship lies in the details — from hand-built cabinets to finish carpentry that transforms entire rooms. Based in Pittsburgh, we take pride in delivering Black & Gold quality with clear communication and dependable timelines.</p>
</section>


    <!-- ===== CONTACT ===== -->
    <section id="contact" class="page-hero fade-section">
      <h2>Contact</h2>
      <p>Email: <a href="mailto:info@prestigepgh.com">info@prestigepgh.com</a> • Phone: <a href="tel:+14123159189">+1-(412)-315-9189</a></p>
      <div class="footer-cta">
        <a href="#contact" class="btn" aria-label="Request a project estimate">Request a Quote</a>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <p>&copy; <span id="year"></span> Pittsburgh Prestige Remodeling. All rights reserved.</p>
    <div class="social-links">
      <a href="https://www.linkedin.com/" target="_blank" rel="noopener">LinkedIn</a>
      <a href="https://www.instagram.com/" target="_blank" rel="noopener">Instagram</a>
    </div>
  </footer>

  <!-- Fancybox -->
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script>

  <script>
    /* ---------------- Logo fallback to your Downloads path (dev only) ---------------- */
    (function logoFallback(){
      const logo = document.getElementById('brandLogo');
      if(!logo) return;
      logo.addEventListener('error', () => {
        // Windows local fallback (for your dev box). Will not work once deployed (and shouldn't be needed).
        logo.src = 'file:///C:/Users/couti/Downloads/prestigepgh/assets/ppr_logo.png';
      }, { once: true });
    })();

    /* ---------------- Theme: dark default, toggle available ---------------- */
    (function themeInit(){
      const root = document.documentElement;
      const btn = document.getElementById('themeToggle');
      // Respect saved choice if available
      const saved = localStorage.getItem('ppr-theme');
      if(saved){ root.setAttribute('data-theme', saved); btn.textContent = saved === 'dark' ? 'Dark' : 'Light'; btn.setAttribute('aria-pressed', saved === 'dark'); }
      else {
        // Default to dark
        root.setAttribute('data-theme', 'dark');
        btn.textContent = 'Dark';
        btn.setAttribute('aria-pressed', 'true');
      }
      btn.addEventListener('click', ()=>{
        const current = root.getAttribute('data-theme') || 'dark';
        const next = current === 'dark' ? 'light' : 'dark';
        root.setAttribute('data-theme', next);
        localStorage.setItem('ppr-theme', next);
        btn.textContent = next === 'dark' ? 'Dark' : 'Light';
        btn.setAttribute('aria-pressed', next === 'dark');
      });
    })();

    /* ---------------- Mobile nav + header hide + fade-in ---------------- */
    (function navInit(){
      const btn = document.getElementById('menuToggle');
      const nav = document.getElementById('navbar');
      if (btn && nav){
        btn.addEventListener('click', ()=>{
          const open = nav.classList.toggle('open');
          btn.classList.toggle('open');
          btn.setAttribute('aria-expanded', open ? 'true' : 'false');
          if (window.innerWidth <= 960) document.body.classList.toggle('no-scroll', open);
        });
        nav.querySelectorAll('a').forEach(a => a.addEventListener('click', ()=>{
          if (window.innerWidth <= 960){
            nav.classList.remove('open'); btn.classList.remove('open');
            document.body.classList.remove('no-scroll'); btn.setAttribute('aria-expanded','false');
          }
        }));
      }
      let lastY = window.scrollY; const header = document.getElementById('header');
      window.addEventListener('scroll', ()=>{
        const y = window.scrollY;
        header.style.transform = (y > lastY && y > 120) ? 'translateY(-100%)' : 'translateY(0)';
        lastY = y;
      }, { passive:true });

      const faders = document.querySelectorAll('.fade-section');
      const io = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) { entry.target.classList.add('visible'); observer.unobserve(entry.target); }
        });
      }, { threshold: 0.17 });
      faders.forEach(f => io.observe(f));
    })();

    /* ---------------- Data loading for Projects ---------------- */
    const MANIFEST_PATH = '/gallery/imagePaths.json'; // keep this path; start with an empty manifest

    async function loadManifest(){
      try{
        const res = await fetch(MANIFEST_PATH, { cache:'no-cache' });
        if (!res.ok) throw new Error('manifest not found');
        return await res.json();
      }catch(e){
        console.warn('imagePaths.json not found yet – starting with an empty manifest.');
        return { categories:{} };
      }
    }

    /* ---------------- Helpers ---------------- */
    function pickThumbAndSrc(item){
      const widths = (item.widths || []).slice().sort((a,b)=>a-b);
      const largest = widths.length ? widths[widths.length-1] : null;
      const mid = widths.find(w => w >= 1280) || widths[0] || largest;
      const avifMid = item.variants?.avif?.[mid];
      const jpgLargest = item.variants?.jpg?.[largest];
      const avifLargest = item.variants?.avif?.[largest];
      const thumb = avifMid || jpgLargest || avifLargest;
      const src   = jpgLargest || avifLargest || avifMid;
      return { thumb, src };
    }

    function pathPartsFromAnyVariant(item){
      const all = [
        ...Object.values(item.variants?.jpg || {}),
        ...Object.values(item.variants?.avif || {})
      ];
      const p = all[0] || '';
      const parts = p.split('/').filter(Boolean);
      const iGallery = parts.indexOf('gallery');
      if (iGallery === -1 || parts.length < iGallery+3) {
        return { country:'Projects', city:'General', parts };
      }
      const country = parts[iGallery+1] || 'Projects';
      const city = parts[parts.length-2] || 'General';
      return { country, city, parts };
    }

    function buildCountryCity(manifest){
      const byCountry = new Map();
      const cats = manifest.categories || {};
      Object.keys(cats).forEach(cat=>{
        (cats[cat] || []).forEach(item=>{
          const { country, city } = pathPartsFromAnyVariant(item);
          const { thumb, src } = pickThumbAndSrc(item);
          const photo = { title:item.alt || city, caption:'', thumb, src };
          if (!byCountry.has(country)) byCountry.set(country, new Map());
          const byCity = byCountry.get(country);
          if (!byCity.has(city)) byCity.set(city, []);
          byCity.get(city).push(photo);
        });
      });

      const countries = Array.from(byCountry.entries()).map(([country, cityMap])=>{
        const cities = Array.from(cityMap.entries()).map(([city, photos])=>{
          const cover = photos[0]?.thumb;
          return { id: city, title: city, cover, photos, country };
        }).sort((a,b)=>a.title.localeCompare(b.title));

        const cover = cities[0]?.cover;
        return { id: country, title: country, cover, children: cities };
      }).sort((a,b)=>a.title.localeCompare(b.title));

      return { title:'All Projects', children: countries };
    }

    /* ---------------- Router / render (albums & photos) ---------------- */
    function getPath(){
      const hash = decodeURI(location.hash || '#/');
      const cleaned = hash.replace(/^#\//,'');
      if (!cleaned || cleaned.startsWith('top')) return [];
      return cleaned.split('/').filter(Boolean);
    }
    function setPath(parts){ location.hash = '#/' + parts.map(encodeURI).join('/'); }

    const breadcrumbsEl = document.getElementById('breadcrumbs');
    const albumsView = document.getElementById('albumsView');
    const photosView = document.getElementById('photosView');
    const emptyState = document.getElementById('emptyState');
    const backBtn = document.getElementById('backBtn');

    let ROOT = { title:'All Projects', children:[] };

    function findNode(parts){
      if (!parts.length) return ROOT;
      const country = ROOT.children.find(c => (c.id||c.title).toLowerCase() === parts[0].toLowerCase());
      if (!country) return null;
      if (parts.length === 1) return country;
      const city = country.children.find(ci => (ci.id||ci.title).toLowerCase() === parts[1].toLowerCase());
      return city || null;
    }

    function buildCrumbs(parts){
      const frag = document.createDocumentFragment();
      const mkLink = (label, toParts)=>{
        const a = document.createElement('a');
        a.href = '#/' + toParts.map(encodeURI).join('/');
        a.textContent = label;
        a.addEventListener('click', e=>{ e.preventDefault(); setPath(toParts); });
        return a;
      };
      frag.appendChild(mkLink('All Projects', []));
      if (parts[0]){
        const sep = document.createElement('span'); sep.textContent='›'; sep.className='crumb-sep'; sep.style.margin='0 6px';
        frag.appendChild(sep); frag.appendChild(mkLink(parts[0], [parts[0]]));
      }
      if (parts[1]){
        const sep2 = document.createElement('span'); sep2.textContent='›'; sep2.className='crumb-sep'; sep2.style.margin='0 6px';
        frag.appendChild(sep2); frag.appendChild(mkLink(parts[1], [parts[0], parts[1]]));
      }
      breadcrumbsEl.innerHTML = ''; breadcrumbsEl.appendChild(frag);
    }

    function renderAlbums(nodes){
      albumsView.innerHTML = '';
      photosView.style.display = 'none';
      albumsView.style.display = 'grid';

      if (!nodes.length){ emptyState.hidden = false; emptyState.textContent = 'No projects added yet.'; return; }
      emptyState.hidden = true;

      nodes.forEach(n=>{
        const card = document.createElement('a');
        card.className='album-card';
        card.href='#';

        const cover = document.createElement('div');
        cover.className='album-cover';

        const cap = document.createElement('div'); cap.className='album-caption';
        const title = document.createElement('div'); title.className='album-title'; title.textContent = n.title;
        const sub = document.createElement('div'); sub.className='album-sub'; sub.textContent = (n.children ? `${n.children.length} Cities` : `${(n.photos||[]).length} Photos`).toUpperCase();

        cap.appendChild(title); cap.appendChild(sub);
        card.appendChild(cover); card.appendChild(cap);

        card.addEventListener('click', e=>{
          e.preventDefault();
          const parts = getPath();
          parts.push(n.id || n.title);
          setPath(parts);
        });

        albumsView.appendChild(card);
      });
    }

    function renderPhotos(node){
      photosView.innerHTML = '';
      albumsView.style.display='none';
      photosView.style.display='grid';

      const photos = node.photos || [];
      if (!photos.length){ emptyState.hidden=false; emptyState.textContent='No photos added for this project yet.'; return; }
      emptyState.hidden = true;

      photos.forEach((p)=>{
        const a = document.createElement('a');
        a.href = p.src;
        a.setAttribute('data-fancybox', node.title || 'project');
        if (p.title) a.setAttribute('data-caption', p.title);

        const tile = document.createElement('div'); tile.className='photo';
        a.appendChild(tile);
        photosView.appendChild(a);
      });

      bindFancybox();
    }

    function render(){
      const parts = getPath();
      buildCrumbs(parts);
      backBtn.style.display = parts.length ? 'inline-flex' : 'none';

      const node = findNode(parts);
      if (!node){ setPath([]); return; }

      if (node.children) renderAlbums(node.children);
      else renderPhotos(node);
    }

    function bindFancybox(){
      Fancybox.bind('[data-fancybox]', {
        Toolbar: { display: ['close'] },
        Images:  { zoom: false, click: false, wheel: false },
        Thumbs:  { autoStart: false }
      });
    }

    (async function init(){
      // Set year
      const y = document.getElementById('year'); if (y) y.textContent = new Date().getFullYear();

      // Build gallery structure & render (empty until you add manifest/photos)
      const manifest = await loadManifest();
      window.ROOT = buildCountryCity(manifest);
      render();
      window.addEventListener('hashchange', render);
      document.getElementById('backBtn').addEventListener('click', ()=>{ const parts = getPath(); parts.pop(); setPath(parts); });
    })();
  </script>
</body>
</html>
